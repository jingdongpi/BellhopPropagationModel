# å°„çº¿æ¨¡å‹å‚æ•°ä½¿ç”¨ä¿®å¤æŠ¥å‘Š

## é—®é¢˜æè¿°
åŸå§‹ä»£ç åœ¨è®¡ç®—ä¼ æ’­æŸå¤±ã€å°„çº¿ç­‰æ•°æ®æ—¶æ²¡æœ‰ä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„å°„çº¿æ¨¡å‹å‚æ•° (ray_model_para)ï¼ŒåŒ…æ‹¬ï¼š
- grazing_high (æ å°„è§’ä¸Šé™)
- grazing_low (æ å°„è§’ä¸‹é™) 
- beam_number (è®¡ç®—ä½¿ç”¨å£°çº¿æ•°é‡)
- is_ray_output (æ˜¯å¦å¯¼å‡ºå£°çº¿ä¿¡æ¯)

## è§£å†³æ–¹æ¡ˆ

### 1. ä¿®æ­£äº†å‚æ•°è§£æé€»è¾‘ (bellhop_wrapper.py)
**æ–‡ä»¶ä½ç½®**: `/python_wrapper/bellhop_wrapper.py`

**ä¿®æ”¹å†…å®¹**:
- ç§»é™¤äº†é”™è¯¯çš„ `beam_para` å‚æ•°å¤„ç†ï¼ˆè¯¥å‚æ•°åœ¨æ¥å£å®šä¹‰ä¸­ä¸å­˜åœ¨ï¼‰
- ä¿®æ­£äº† `ray_model_para` å‚æ•°çš„æ­£ç¡®è§£æï¼š
  ```python
  # è§£æå°„çº¿æ¨¡å‹å‚æ•° - æ ¹æ®æ¥å£å®šä¹‰åªæœ‰ray_model_para
  ray_model_para = data.get('ray_model_para', {})
  is_ray_output = ray_model_para.get('is_ray_output', False)
  beam_number = ray_model_para.get('beam_number', None)
  grazing_high = ray_model_para.get('grazing_high', None)  # æ å°„è§’ä¸Šé™
  grazing_low = ray_model_para.get('grazing_low', None)    # æ å°„è§’ä¸‹é™
  ```

### 2. ä¿®æ”¹äº†Bellhopè®¡ç®—å‡½æ•° (bellhop.py)
**æ–‡ä»¶ä½ç½®**: `/python_core/bellhop.py`

**ä¿®æ”¹å†…å®¹**:
- æ‰©å±•äº† `call_Bellhop` å‡½æ•°ç­¾åï¼Œå¢åŠ å°„çº¿å‚æ•°ï¼š
  ```python
  def call_Bellhop(frequency, source_depth, receiver_depths, receiver_ranges, 
                   bathymetry, sound_speed_profile, sediment, bottom_params,
                   return_pressure=False, performance_mode=False, 
                   beam_number=None, grazing_high=None, grazing_low=None):
  ```

- æ‰©å±•äº† `call_Bellhop_Rays` å‡½æ•°ç­¾åï¼Œå¢åŠ å°„çº¿å‚æ•°ï¼š
  ```python
  def call_Bellhop_Rays(frequency, source_depth, receiver_depths, receiver_ranges,
                        bathymetry, sound_speed_profile, sediment, bottom_params,
                        beam_number=None, grazing_high=None, grazing_low=None):
  ```

- åœ¨å‡½æ•°å†…éƒ¨å®ç°äº†ç”¨æˆ·å‚æ•°çš„å®é™…ä½¿ç”¨ï¼š
  ```python
  # ä½¿ç”¨ç”¨æˆ·æä¾›çš„å°„çº¿æ•°é‡æˆ–è‡ªåŠ¨è®¡ç®—
  if beam_number is not None and beam_number > 0:
      totalBeams = int(beam_number)
      print(f"ä½¿ç”¨ç”¨æˆ·æŒ‡å®šçš„å°„çº¿æ•°é‡: {totalBeams}")
  else:
      # è‡ªåŠ¨è®¡ç®—é€»è¾‘...
  
  # ä½¿ç”¨ç”¨æˆ·æä¾›çš„æ å°„è§’èŒƒå›´æˆ–è‡ªåŠ¨è®¡ç®—
  if grazing_low is not None and grazing_high is not None:
      Alpha = [float(grazing_low), float(grazing_high)]
      print(f"ä½¿ç”¨ç”¨æˆ·æŒ‡å®šçš„æ å°„è§’èŒƒå›´: {grazing_low}Â° åˆ° {grazing_high}Â°")
  else:
      # è‡ªåŠ¨è®¡ç®—é€»è¾‘...
  ```

### 3. ä¿®æ”¹äº†å‡½æ•°è°ƒç”¨ä¼ å‚ (bellhop_wrapper.py)
**ä¿®æ”¹å†…å®¹**:
- åœ¨ `solve_bellhop_propagation` å‡½æ•°ä¸­ï¼Œæ‰€æœ‰å¯¹ `call_Bellhop` å’Œ `call_Bellhop_Rays` çš„è°ƒç”¨éƒ½ä¼ é€’äº†å°„çº¿å‚æ•°ï¼š
  ```python
  rays = call_Bellhop_Rays(freq, sd, rd, receiver_range, bathm, ssp, sed, base,
                           beam_number=beam_number, grazing_high=grazing_high, grazing_low=grazing_low)
  
  pos, TL, pressure = call_Bellhop(freq, sd, rd, receiver_range, bathm, ssp, sed, base, 
                                   return_pressure=True, performance_mode=False,
                                   beam_number=beam_number, grazing_high=grazing_high, grazing_low=grazing_low)
  ```

## æµ‹è¯•éªŒè¯

### æµ‹è¯•ç”¨ä¾‹
ä½¿ç”¨ `examples/input.json` æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹å°„çº¿æ¨¡å‹å‚æ•°ï¼š
```json
"ray_model_para": {
    "grazing_low": -90.0,
    "grazing_high": 90.0,
    "beam_number": 100,
    "is_ray_output": true
}
```

### æµ‹è¯•ç»“æœ
âœ… **å‚æ•°æ­£ç¡®è§£æ**: æˆåŠŸè§£ææ‰€æœ‰ ray_model_para å‚æ•°
âœ… **å‚æ•°æ­£ç¡®ä½¿ç”¨**: è®¡ç®—è¿‡ç¨‹æ˜¾ç¤ºä½¿ç”¨äº†ç”¨æˆ·æŒ‡å®šçš„å‚æ•°
âœ… **ç»“æœæ­£ç¡®ç”Ÿæˆ**: ç”Ÿæˆäº†100æ¡å°„çº¿çš„å°„çº¿è¿½è¸ªæ•°æ®å’Œä¼ è¾“æŸå¤±æ•°æ®

### æµ‹è¯•è¾“å‡ºç¤ºä¾‹
```
=== è¾“å…¥æ–‡ä»¶å‚æ•°æ£€æŸ¥ ===
âœ“ æ‰¾åˆ° ray_model_para: {'grazing_low': -90.0, 'grazing_high': 90.0, 'beam_number': 100, 'is_ray_output': True}
âœ“ ç”¨æˆ·æŒ‡å®šå°„çº¿æ•°é‡: 100
âœ“ ç”¨æˆ·æŒ‡å®šæ å°„è§’èŒƒå›´: -90.0Â° åˆ° 90.0Â°
âœ“ å°„çº¿è¾“å‡ºè®¾ç½®: True

=== å¼€å§‹Bellhopè®¡ç®—æµ‹è¯• ===
ä½¿ç”¨ç”¨æˆ·æŒ‡å®šçš„å°„çº¿æ•°é‡: 100
ä½¿ç”¨ç”¨æˆ·æŒ‡å®šçš„æ å°„è§’èŒƒå›´: -90.0Â° åˆ° 90.0Â°
âœ“ è®¡ç®—æˆåŠŸå®Œæˆ
âœ“ å°„çº¿è¿½è¸ªæ•°æ®å·²ç”Ÿæˆï¼ŒåŒ…å« 100 æ¡å°„çº¿
âœ“ ä¼ è¾“æŸå¤±æ•°æ®å·²ç”Ÿæˆ
```

## ä¿®å¤çŠ¶æ€
ğŸ‰ **å®Œæˆ** - æ‰€æœ‰ç”¨æˆ·å°„çº¿æ¨¡å‹å‚æ•°ç°åœ¨éƒ½è¢«æ­£ç¡®è§£æå’Œä½¿ç”¨ï¼š
- âœ… grazing_high (æ å°„è§’ä¸Šé™)
- âœ… grazing_low (æ å°„è§’ä¸‹é™) 
- âœ… beam_number (è®¡ç®—ä½¿ç”¨å£°çº¿æ•°é‡)
- âœ… is_ray_output (æ˜¯å¦å¯¼å‡ºå£°çº¿ä¿¡æ¯)

## æ–‡ä»¶æ¸…å•
ä¿®æ”¹çš„æ–‡ä»¶ï¼š
1. `/python_wrapper/bellhop_wrapper.py` - å‚æ•°è§£æå’Œå‡½æ•°è°ƒç”¨
2. `/python_core/bellhop.py` - Bellhopè®¡ç®—å‡½æ•°å®ç°

æ–°å¢çš„æ–‡ä»¶ï¼š
1. `/test_ray_params.py` - å°„çº¿å‚æ•°æµ‹è¯•è„šæœ¬
